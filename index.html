<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>画像から切り絵を生成するWebツール 兼 画像から輪郭を抽出するWebツール</title>
  <!-- 外部ライブラリ -->
  <script src="./vendor/viewport-extra.js"></script>
  <script>new ViewportExtra(375)</script>
  <script src="./vendor/vue.js"></script>
  <script src="./vendor/imagetracer.js"></script>
  <script src="./vendor/canvg.js"></script>
  <!-- CSS -->
  <link rel="stylesheet" href="./css/style.css">
  <link rel="stylesheet" href="./css/plus_minus_input_number.css">
</head>
<body>
  <h1>画像から切り絵を生成するWebツール 兼 画像から輪郭を抽出するWebツール</h1>
  <div id="app" v-cloak>
    <div class="radio-wrapper" v-show="!isMobile">
      <div class="radio" :class="{'selected': editDirection === 'vertical'}" @click="editDirection = 'vertical'">縦</div>
      <div class="radio" :class="{'selected': editDirection === 'horizontal'}" @click="editDirection = 'horizontal'">横</div>
    </div>

    <div class="input-file-container">
      <div class="input-file">
        <div class="btn" @click="$refs.inputImageFile.click()">ファイルを選択</div>
        <input type="file" ref="inputImageFile" @change="onChangeInputImageFile">
      </div>
      <div class="file-name">{{imageFileName}}</div>
    </div>

    <div id="action-btn-container" v-show="editDirection === 'horizontal'">
      <div class="input-check-area">
        <div class="btn action-btn" @click="onClickRemoveNoise">ノイズ除去</div>
      </div>
      <div class="input-check-area">
        <div class="btn action-btn" @click="onClickThickness">太く</div>
      </div>
      <div class="input-check-area">
        <div class="btn action-btn" @click="onClickConvertToSVG">溶かす</div>
      </div>
      <div class="input-check-area">
        <div class="btn action-btn" @click="onClickReset">リセット</div>
      </div>
    </div>

    <div class="image-container">
      <div id="src-title">無加工画像</div>
      <img ref="srcImage" style="max-width: 600px; aspect-ratio: 600 / 444;">
    </div>

    <div id="setting">
      <div class="item">
        <div class="name">幅</div>
        <div class="input">
          <plus-minus-input-numbur
            :min="imageWidthMin"
            :max="imageWidthMax"
            v-model="imageWidth"
            @change="onChangeImageWidth">
        </div>
      </div>

      <div class="item">
        <div class="name">
          <div>輪郭検出法</div>
        </div>
        <div class="input">
          <select v-model="outlineAlgorithm" @change="onChangeOutlineAlgorithm">
            <option :value="'sobelFilter'">SobelFilter</option>
            <option :value="'prewittFilter'">PrewittFilter</option>
            <option :value="'cannyEdgeDetection'">Canny</option>
            <option :value="'laplacianFilter'">LaplacianFilter</option>
          </select>
        </div>
      </div>

      <div class="item" v-show="outlineAlgorithm === 'cannyEdgeDetection'">
        <div class="name">
          <div>エッジ(低)</div>
          <div class="hosoku">多:0-255:少</div>
        </div>
        <div class="input">
          <plus-minus-input-numbur
            :min="0"
            :max="255"
            v-model="lowThreshold"
            @change="onChangeLowThreshold">
        </div>
      </div>
      <div class="item" v-show="outlineAlgorithm === 'cannyEdgeDetection'">
        <div class="name">
          <div>エッジ(高)</div>
          <div class="hosoku">多:0-255:少</div>
        </div>
        <div class="input">
          <plus-minus-input-numbur
            :min="0"
            :max="255"
            v-model="highThreshold"
            @change="onChangeHighThreshold">
        </div>
      </div>

      <div class="item">
        <div class="name">
          <div>2値化</div>
        </div>
        <div class="input">
          <div class="radio-wrapper">
            <div class="radio" :class="{'selected': shouldBinarize}" @click="onClickShouldBinarize(true)">する</div>
            <div class="radio" :class="{'selected': !shouldBinarize}" @click="onClickShouldBinarize(false)">しない</div>
          </div>
        </div>
      </div>

      <div class="item" v-show="shouldBinarize">
        <div class="name">
          <div>輪郭黒</div>
          <div class="hosoku">少:0-255:多</div>
        </div>
        <div class="input">
          <plus-minus-input-numbur
            :min="0"
            :max="255"
            v-model="baseOutlineAverageColor"
            @change="onChangeBaseOutlineAverageColor">
        </div>
      </div>

      <div class="item" v-show="shouldBinarize">
        <div class="name">
          <div>有色部</div>
        </div>
        <div class="input">
          <div class="radio-wrapper">
            <div class="radio" :class="{'selected': needColoredAreas}" @click="onClickNeedColoredAreas(true)">いる</div>
            <div class="radio" :class="{'selected': !needColoredAreas}" @click="onClickNeedColoredAreas(false)">いらない</div>
          </div>
        </div>
      </div>

      <div class="item" v-show="shouldBinarize && needColoredAreas">
        <div class="name">
          <div>有色黒</div>
          <div class="hosoku">少:0-255:多</div>
        </div>
        <div class="input">
          <plus-minus-input-numbur
            :min="0"
            :max="255"
            v-model="baseColoredAreasAverageColor"
            @change="onChangeBaseColoredAreasAverageColor">
        </div>
      </div>

      <div class="item">
        <div class="name">
          <div>ガンマ補正</div>
          <div class="hosoku">濃:0-2:薄</div>
        </div>
        <div class="input">
          <plus-minus-input-numbur
            :min="0"
            :max="2"
            :step="0.02"
            :decimal-places="3"
            v-model="gamma"
            @change="onChangeGamma">
        </div>
      </div>
    </div>

    <div id="action-btn-container" v-show="editDirection === 'vertical'">
      <div class="input-check-area">
        <div class="btn action-btn" @click="onClickRemoveNoise">ノイズ除去</div>
      </div>
      <div class="input-check-area">
        <div class="btn action-btn" @click="onClickThickness">太く</div>
      </div>
      <div class="input-check-area">
        <div class="btn action-btn" @click="onClickConvertToSVG">溶かす</div>
      </div>
      <div class="input-check-area">
        <div class="btn action-btn" @click="onClickReset">リセット</div>
      </div>
    </div>

    <div class="image-container">
      <div id="dst-title">加工画像</div>
      <img ref="dstImage" style="max-width: 600px; aspect-ratio: 600 / 444;">
    </div>

    <div style="margin-top: 16px; margin-bottom: 24px;">
      <span style="color: red; font-weight: bold;">
        <template v-if="isMobile">
          画像は長押しでダウンロードできます。<br>
        </template>
        <template v-else>
          画像は右クリックでダウンロードできます。<br>
        </template>
      </span>
      輪郭が少ない場合は輪郭黒の値を大きくしてください。<br>
      2値化なしで有色部がなくなるのは仕様です。<br>
      細かい調整はペイントソフトでも使って…
    </div>

    <div id="processing" v-show="isProcessing">
      処理中… {{moon}}
    </div>
  </div>

  <script src="./components/plus_minus_input_numbur.js"></script>
  <script src="./image_editor.js"></script>
  <script src="./main.js"></script>
</body>
</html>
