<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>画像から切り絵を生成するWebツール 兼 画像から輪郭を抽出するWebツール</title>
  <!-- レスポンシブ対応 -->
  <script src="https://cdn.jsdelivr.net/npm/viewport-extra@1.0.3/dist/viewport-extra.min.js"></script>
  <script>new ViewportExtra(375)</script>
  <!-- CDN -->
  <script src="https://cdn.jsdelivr.net/npm/vue@3.4.21/dist/vue.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/imagetracerjs@1.2.6/imagetracer_v1.2.6.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/canvg/3.0.9/umd.min.js" integrity="sha512-uFbOsMTwJI9fB3saQ+aHUcHuhRyxxHonT7AWjFL25AglbRxiG7x3+3jDAA9YGVpgrdKRBTBHdSx9Xnyt7VsDNQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <!-- CSS -->
  <link rel="stylesheet" href="./css/style.css">
  <link rel="stylesheet" href="./css/plus_minus_input_number.css">
</head>
<body>
  <h1>画像から切り絵を生成するWebツール 兼 画像から輪郭を抽出するWebツール</h1>
  <div id="app" v-cloak>
    <div class="input-file-container">
      <div class="input-file">
        <div class="btn" @click="$refs.inputImageFile.click()">ファイルを選択</div>
        <input type="file" ref="inputImageFile" @change="onChangeInputImageFile">
      </div>
      <div class="file-name">{{imageFileName}}</div>
    </div>

    <div class="canvas-container">
      <div id="src-title">無加工画像</div>
      <img ref="srcImage">
    </div>

    <div id="setting">
      <div class="item">
        <div class="name">幅</div>
        <div class="input">
          <plus-minus-input-numbur
            :min="imageWidthMin"
            :max="imageWidthMax"
            v-model="imageWidth"
            @change="onChangeImageWidth">
        </div>
      </div>

      <div class="item">
        <div class="name">
          <div>輪郭検出法</div>
        </div>
        <div class="input">
          <select v-model="outlineAlgorithm" @change="onChangeOutlineAlgorithm">
            <option :value="'sobelFilter'">SobelFilter</option>
            <option :value="'prewittFilter'">PrewittFilter</option>
            <option :value="'cannyEdgeDetection'">Canny</option>
            <option :value="'laplacianFilter'">LaplacianFilter</option>
          </select>
        </div>
      </div>

      <div class="item" v-show="outlineAlgorithm === 'cannyEdgeDetection'">
        <div class="name">
          <div>エッジ(低)</div>
          <div class="hosoku">多:0-255:少</div>
        </div>
        <div class="input">
          <plus-minus-input-numbur
            :min="0"
            :max="255"
            v-model="lowThreshold"
            @change="onChangeLowThreshold">
        </div>
      </div>
      <div class="item" v-show="outlineAlgorithm === 'cannyEdgeDetection'">
        <div class="name">
          <div>エッジ(高)</div>
          <div class="hosoku">多:0-255:少</div>
        </div>
        <div class="input">
          <plus-minus-input-numbur
            :min="0"
            :max="255"
            v-model="highThreshold"
            @change="onChangeHighThreshold">
        </div>
      </div>

      <div class="item">
        <div class="name">
          <div>輪郭黒</div>
          <div class="hosoku">少:0-255:多</div>
        </div>
        <div class="input">
          <plus-minus-input-numbur
            :min="0"
            :max="255"
            v-model="baseOutlineAverageColor"
            @change="onChangeBaseOutlineAverageColor">
        </div>
      </div>

      <div class="item">
        <div class="name">
          <div>有色部</div>
        </div>
        <div class="input">
          <div class="radio-wrapper">
            <div class="radio" :class="{'selected': needColoredAreas}" @click="onClickNeedColoredAreas(true)">いる</div>
            <div class="radio" :class="{'selected': !needColoredAreas}" @click="onClickNeedColoredAreas(false)">いらない</div>
          </div>
        </div>
      </div>

      <div class="item" v-show="needColoredAreas">
        <div class="name">
          <div>有色黒</div>
          <div class="hosoku">少:0-255:多</div>
        </div>
        <div class="input">
          <plus-minus-input-numbur
            :min="0"
            :max="255"
            v-model="baseColoredAreasAverageColor"
            @change="onChangeBaseColoredAreasAverageColor">
        </div>
      </div>

      <div class="item">
        <div class="name">
          <div>ガンマ補正</div>
          <div class="hosoku">濃:0-2:薄</div>
        </div>
        <div class="input">
          <plus-minus-input-numbur
            :min="0"
            :max="2"
            :step="0.02"
            :decimal-places="3"
            v-model="gamma"
            @change="onChangeGamma">
        </div>
      </div>
    </div>

    <div id="action-btn-container">
      <div class="input-check-area">
        <div class="btn action-btn" @click="onClickRemoveNoise">ノイズ除去</div>
      </div>
      <div class="input-check-area">
        <div class="btn action-btn" @click="onClickThickness">太く</div>
      </div>
      <div class="input-check-area">
        <div class="btn action-btn" @click="onClickConvertToSVG">溶かす</div>
      </div>
      <div class="input-check-area">
        <div class="btn action-btn" @click="onClickReset">リセット</div>
      </div>
    </div>

    <div class="canvas-container">
      <div id="dst-title">加工画像</div>
      <img ref="dstImage">
    </div>

    <div style="margin-top: 16px;">
      細かい調整はペイントソフトでも使って…
    </div>
  </div>

  <script src="./components/plus_minus_input_numbur.js"></script>
  <script src="./image_editor.js"></script>
  <script src="./main.js"></script>
</body>
</html>
